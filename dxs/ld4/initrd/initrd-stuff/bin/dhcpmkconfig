#!/bin/sh
#
# Description:  universal (distro independent) configuration writer for 
#		several dhcp clients 
#
# Author(s):    Dirk von Suchodoletz <dirk@goe.net>, 17-01-2006
#		Blabla
#		Blub
#
# Copyright:    (c) 2006 - RZ Universitaet Freiburg

# functions common for all distros
. /etc/functions

# client variable should be exported via calling function
echo -e "\n# ip configuration written by $0" \
  >>/etc/machine-setup
case $0 in
  *dhcpd*)
    cat /var/lib/dhcp/dhcpcd-eth0.info | sed -e "s,',\",g" \
      -e "s,IPADDR,clientip," -e "s,NETMASK,subnet_mask," \
      -e "s,GATEWAY,gateway," -e "s,BROADCAST,broadcast_address," \
      -e "s,HOSTNAME,host_name," -e "s,DOMAIN,domain_name," \
      -e "s,ROOTPATH,root_path," -e "s,DNS,domain_name_servers," \
      -e "s,NTPSERVERS,ntp_servers," -e "s,DHCPSID,serverip," \
      -e "s,WINSSERVERS,netbios_name_servers," \
      -e "s,NETWORK,network," \
      -e "s,DHCP..ADDR.*,," -e "s,.*TIME=.*,," -e "s,CL.*,," \
      -e "s,INTER.*,," -e "s,DHCPSNAME.*,," \
        >>/etc/machine-setup
    # empty lines should be removed somehow
  ;;
  *dhclient*)
    set | sed -n -e '/^new/p' | sed \
      -e "s,^new_,," -e "s,fixed-address,clientip," \
      -e "s,routers,gateway," -e "s,dhcp-server-identifier,serverip," \
      -e "s,.*_t[iy][mp]e.*,," -e "s,.*_message_.*,," -e "/^$/d" \
      -e "s,language=,country=," \
        >>/etc/machine-setup
  ;;
esac
