# Description:  configuration functions for SuSE 10.1 which differ from
#		functions defined for SuSE 9.3 which is base ... General
#		changes should be done there, version specific changes for
#		the 10.0 here.
#
# Author(s):    Dirk von Suchodoletz <dirk@goe.net>, 08-02-2006
#		Blabla
#		Blub
#
# Copyright:    (c) 2006 - RZ Universitaet Freiburg
# 
# Version:      0.2.1c

# distro specific stuff to initialize
preinit () {
for i in usb_id scsi_id vol_id edd_id hwup ifup ; do
  echo -e "#!/bin/sh\n:" >/sbin/$i
done
mkdir /lib/udev /usr/sbin
for i in idedma.sh mount.sh rename_netiface create_floppy_devices ; do
  echo -e "#!/bin/sh\n:" >/lib/udev/$i
done
echo -e "#!/bin/sh\n:" >/usr/sbin/alsactl
chmod u+x /sbin/* /lib/udev/* /usr/sbin/*
}

# udev service
udev_hotplug () {
local result=0
echo "Starting udev"
#mknod /dev/console c 5 1
#mknod /dev/null c 1 3
#mknod /dev/kmsg c 1 11
if [ -x /bin/udevd ] ; then
  echo "" > /proc/sys/kernel/hotplug
  udevd --daemon || result=1
  trigger_device_events
  usleep 50
else error "  udev daemon is not available. Some devices might not \
apprear." nonfatal
fi
return $result
}

# acpi and powersave have changed
config_acpi () {
local start_acpi=10
local stop_acpi=12
local start_powersave=11
local stop_powersave=11
rllinker acpid "$start_acpi" "$stop_acpi"
rllinker powersaved "$start_powersave" "$stop_powersave"
}

# configure dbus (inter application communication for kde and gnome), hal
# (hardware abstraction layer - used e.g. by powersaved) and resmgr
# (resource manager - the user gets permissions to devices when loggin on)
# runlevel script for haldaemon is now haldaemon instead of hal
config_dreshal () {
local start="05"
local stop="18"
if [ "x$start_dreshal" = "xyes" ]; then
  if [ -f /mnt/etc/init.d/dbus ] ; then
  strinfile "messagebus:" /mnt/etc/passwd || \
    echo "messagebus:x:100:101:User for D-BUS:/var/run/dbus:/bin/false" \
      >> /mnt/etc/passwd
    testmkd /mnt/var/run/dbus
    # chown 100:101 /mnt/var/run/dbus
    rllinker "dbus" "$start" "$stop"
  fi
  if [ -f /mnt/etc/init.d/resmgr ] ; then
    testmkd /mnt/var/run/resmgr/classes
    start="0"`expr $start + 1`
    stop="0"`expr $start - 1`
    rllinker "resmgr" "$start" "$stop"
  fi
  if [ -f /mnt/etc/init.d/haldaemon ] ; then
    strinfile "haldaemon:" /mnt/etc/passwd || \
      echo "haldaemon:x:105:103:User for haldaemon:/var/run/hal:/bin/false" \
        >> /mnt/etc/passwd
    start="0"`expr $start + 1`
    stop="0"`expr $start - 1`
    rllinker "haldaemon" "$start" "$stop"
  fi
fi
}

