# Description:  configuration script for Ubuntu V5.10 to configure
#		linux diskless clients (executed within initial
#		ramdisk after genconfig) 
#
# Author(s):    Dirk von Suchodoletz <dirk@goe.net>, 31-03-2006
#
# Copyright:    (c) 2006 - RZ Universitaet Freiburg
# 
# Version:      0.0.1d

# distro specific stuff to initialize
preinit () {
 :
}

postinit () {
  :
}

# distro specific general function called from servconfig script
config_distro () {
echo -e "dxs version 4.0a\initramfs generation date $date" \
  >> /mnt/etc/gentoo-release
}

# udev service - not checked!
udev_hotplug () {
echo "Starting udev"
ln -s /bin/udevd /bin/udevstart && udevstart &
if [ -x /bin/udevd ] ; then
  export UDEVD_EXPECTED_SEQNUM=$(cat /sys/kernel/hotplug_seqnum)
  export UDEVD_EVENT_TIMEOUT=1
  echo "" > /proc/sys/kernel/hotplug
  udevd &
else error "  udev daemon is not available. Some devices might not \
apprear." nonfatal
fi
}

# initialize boot.ld - skript to be executed during early system startup
# (before most of the normal boot init scripts)
# this script should operate like a normal runlevel script
# initialize boot.ld - skript to be executed during early system startup
# (before most of the normal boot init scripts)
# this script should operate like a normal runlevel script (fixme!!)
d_mkrlscript () {
local switch="$1"
local name="$2"
local info="$3"
case "$switch" in
  init)
    echo -e "#!/sbin/runskript\n# skeleton of /etc/${D_INITDIR}/$name \
generated by $0" >/mnt/etc/${D_INITDIR}/$name
    echo -e "\n\nstart() {\tebegin \"$info\"" \
      >>/mnt/etc/${D_INITDIR}/$name
    chmod u+x /mnt/etc/${D_INITDIR}/$name
  ;;
  close)
    echo -e "\t;;\n    stop)\n\t;;\nesac\nexit 0" \
      >>/mnt/etc/${D_INITDIR}/$name
  ;;
esac
}

